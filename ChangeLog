*** Don't forget to increment the version number in ftpd.cl for each commit
*** [and leave this message at the top of the file]

2002-02-19  D Layer  <layer@relay.known.net>
1.0.12

	* README: reorganize and add a little more info
	* CONFIG, config.cl, ftpd.cl:
	renamed CONFIG to config.cl, and include it during the compilation
	of ftpd.cl

2002-02-14  Kevin Layer  <layer@crikey>
1.0.11

	* ftpd.cl: add version #

2002-01-21  Ahmon Dancy  <dancy@dancy>

	* CONFIG: Added RCS id tag.  Added pointer to Security notes
	section in README for conversions.

	* README: Added Security notes section.  Added additional info for
	anonymous FTP setup

	* ftpd.cl: Added pointer to Security notes section in README for
	conversions.  

2002-01-18  Ahmon Dancy  <dancy@dancy>

	* README: Fleshed out.

	* CONFIG: New file w/ configuration section of ftpd.cl for
	documentation purposes.

	* ftpd.cl:  Made the connection banner a configurable parameter.

	Added a gang of comments for the config params.

2002-01-07  Ahmon Dancy  <dancy@dancy>

	* ftpd.cl:
	Added parameter *pidsfile* which holds the path to the pids file.
	The pids file keeps track of ftpd's that may be running (for in
	limiting the number of connections).

	Changed the default control channel timeout to 5 minutes.

	Added kill() foreign call.

	Added some macros related to forking.

	Removed old child reaping code.  It didn't work out well.
	Children are now immediately orphaned so that they become children
	of process id #1 (init) (which always reaps).  

	New children call add-pid to add their process id to the
	*pidsfile* flie.  

	To check the connections limit, probe-pids-file is called.  This
	function calls kill w/ signal 0 for every pid it finds in the
	*pidsfile* file.  signal 0 doesn't actually send a signal, but
	does error checking.  This effectively checks for the existence of
	a particular processes.  The list of processes that still exist is
	written back to the *pidsfile* file and the count is returned.

	Made NLST use globbing.  Some clients expect this.

2001-12-20  Ahmon Dancy  <dancy@dancy>

	* ftpd.cl: fixed WNOHANG constant for Solaris.

	Changed calls to with-stream-lock (removed :wait keyword..  always
	want to wait).

	* posix-lock.cl:  Added with-saved-file-position macro which
	executes its body with file position set to 0 beforehand and
	restored afterword.    Now using this macro in the lock- and
	unlock-stream functions to ensure the the entire file is locked
	and unlocked.  

2001-12-19  Ahmon Dancy  <dancy@dancy>

	* ftpd.cl: Added make-active-connection function to make a
	PORT-based connection which will log errors.
	establish-data-connection uses this now.

	* ftpd.cl:
	Added *ftpdataport* parameter.  Defaults to 20 and will likely
	never be changed by anyone.

	Added *maxusers* parameter.  If set to a number, it indicates the
	maximum number of clients that can be connected at once.  

	Added *toomanymsg* parameter.  Defaults to /etc/toomany.msg which
	is a file that will be displayed when someone tries to use the
	PASS command when *maxusers* has been reached.

	Renamed *anonymous-???-restricted* to *anonymous-???-disabled*.

	Changed conversion list.  No need to call (vector) for vector
	literals.

	Added summore foreign calls for uid management.

	Added *extra-files* parameter which lists the other source files
	that go w/ this app.

	Program is now easy to kill with control-C in debug mode.

	Added code to keep track of how many children there are.

	Added parameter *reaptime* to control how often a check is done
	for an exited child.  Defaults to 10 seconds.  Set to a lower
	value if you want higher accuracy.

	strerror: If 'errno' is null, return "Unknown error".

	outline: Used Kevin's code for making sure that security problems
	don't creep in from programming mistakes using outline without a
	format string.

	Removed with-output-to-client macro.  It was only used in one
	place and wasn't necessary.

	stderr-reader: Logs to ftp log instead of standard output.

	get-request:  Maximum line length is now 5000 characters.
	Updated this function to gracefully deal with too-long lines.  The
	entire line is ignored and a line-too-long error is returned to
	the client.

	Added macro with-root-privs for doing certain operations that
	require root privs.  This should be checked for any potential
	issues.
	
	cmd-pass: Added maxusers check.   Changed call to setgid to
	setegid.  Changed call to setuid to seteuid.  Now we can recover
	root privs when necessary [and so can anyone who manages to find
	some exploit to execute arbitrary code].

	dump-msg:  New function to dump a file to the control connection,
	prefixed by a code.   dump-welcome-msg was removed and the call to
	it was replaced w/ a call to dump-msg.  The too-many-users file is
	displayed using this now as well.

	PORT-based FTP data connections now use the local port
	*ftpdataport* (default, 20).  Some clients required this.  Using
	port 20 requires root privs.

	Fixed several places where I used 't' as the general case in a
	handler-case, rather than 'error'.
		
	Removed compile-regexp from places that it wasn't necessary. jkf
	says that there's a compiler macro for regular expressions.

	make-mdtm-string:  No longer uses C library call.  All built in
	stuff w/ help from Charley.

	glob-single:  Shorter now due to use of enough-namestring.

	make-relative, basename: Unnecessary functions removed.

	ftp-log and xferlog:  Use posix locks to make sure that several
	clients don't smash updates to the logs.  Also, make sure writing
	always begins at the end of the log.  

	main: Make sure that ACL 6.1 or later is being used.  
	Added some command line arguments.  -d to run in debugging mode.
	-p xxxx to use an alternative FTP port.  -f xxx to specify an
	alternate config file.  

	top level:  Complain if trying to build on non-linux, non-Solaris
	platform.

	Moved process group setting stuff into its own function.

	getpwnam.cl: Renamed to passwd.cl

	posix-lock.cl: New

2001-12-11  Ahmon Dancy  <dancy@dancy>

	* ftpd.cl:  Removed dependency on stat.cl.  Changed stuff over to
	use excl::filesys- and other built-in stuff.  

	* stat.cl: Removed

	* ftpd.cl:  Make sure that the anonymous ftp account actually
	exists before allowing an anonymous login.

2001-12-10  Ahmon Dancy  <dancy@dancy>

	* Added *xferlog* parameter which specifies the location of the
	transfer log file.  Added code to do xferlog logging.  The log has
	the following format:

	(universal-time numeric-ip-address file direction bytes user)

	If *debug* is non-nill, the xferlog goes to stdout.	
	
2001-12-08  Ahmon Dancy  <dancy@dancy>

	* Enhanced the *restricted-users* stuff.  If it's 't' everyone is
	restricted except for those users listed in *unrestricted-users*.

	* Rewrote make-full-path since it was missing some situations.

	* The config file is now reloaded for each new connection so that
	changes can be made on the fly.

	* Added *logfile* and it's workings.  

	* Process forks and disassociates from the controlling terminal
	now.  More like a typical daemon.

2001-12-07  Ahmon Dancy  <dancy@dancy>

	* README: added build instructions and fixed a typo.

	* eol.cl:  Some export changes suggested by jkf.

	* ftp.cl:
	Added *restricted-users* variable.  Users in this list will be
	confined to their home directories.   Added code to handle this
	feature.  

	Changed conversions to use vectors instead of strings.  This is
	safer.

	store-file-ascii updated to use external format stuff.

	Turned off globbing support for STAT.

	Added :srecord to generate-executable call.
	
2001-12-06  Ahmon Dancy  <dancy@dancy>

	* Added support for the telnet codes that sometimes get sent
	before ABOR requests.  They're ignored.  Double-IAC codes are
	converted to a single #xff character (in case a filename has such
	a character).  

	* Added cmd-abor.  I thought I had that in there already.

	* Transfer error messages are now ensured to be all on one line.

	* Fixed bug in store-file-binary.  

	* added minimal HELP SITE support.
	
	* Updated the way the config file is loaded.  Add process id to
	ftp-log output.  If *debug* is :verbose, log (outline) data. 

	* eol.cl:  Added some 'require's.

	* ftpd.cl:  Changed the default PASV port range.  Changed *debug*
	to default to nil.  Added *configfile* parameter and code to load
	*configfile* if it exists. 

	Some external format changes.  Using a 6.1-only :e-crlf format
	which eased some application building pains.

	Added ftp-log function for logging.  Changed all relevant format
	statements to calls to ftp-log.

	Changed the "Entering Passive Mode" respond (removed some
	debugging info that upset Opera).

	Added "image" and "ascii" as aliases for "i" and "a" in the TYPE
	command [Bogus browsers.. *sigh*].
	
	Added application-building function.
